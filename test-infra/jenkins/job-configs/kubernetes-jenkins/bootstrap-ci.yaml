- job-template:
    builders:
    - shell: |
        # TODO(fejta): consider a stable tag instead of master
        git clone https://github.com/euank/rktlet -b wip-test-infra
        cd ./rktlet/
        './test-infra/jenkins/bootstrap.py' \
            --bare \
            --job='{job-name}' \
            --root="${{GOPATH}}/src/k8s.io" \
            --service-account="${{GOOGLE_APPLICATION_CREDENTIALS}}" \
            --upload='gs://rktnetes-jenkins/logs'
    disabled: false
    name: 'ci-{suffix}'
    node: 'e2e'
    properties:
    - build-discarder:
        days-to-keep: 7
    triggers:
    - timed: '{frequency}'
    wrappers:
    - e2e-credentials-binding
    - inject:
        properties-content: |
            GOROOT=/usr/local/go
            GOPATH=$WORKSPACE/go
            PATH=$PATH:/home/jenkins/cloudsdk/google-cloud-sdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:$GOROOT/bin:$WORKSPACE/go/bin

    - timeout:
        timeout: 700
        fail: true
    - workspace-cleanup:  # cleanup before the job starts, for clean build.
        dirmatch: true
        exclude:
        - '**/.git/'
        external-deletion-command: 'sudo rm -rf %s'
    publishers:
    - workspace-cleanup:  # cleanup after job finishes, to not waste space.
        dirmatch: true
        exclude:
        - '**/.git/'
        external-deletion-command: 'sudo rm -rf %s'

- project:
    jobs:
    - 'ci-{suffix}'
    name: bootstrap-ci
    suffix:
    - rktnetes-e2e-gce:
        job-name: ci-rktnetes-e2e-gce
        frequency: 'H/5 * * * *' # At least every 30m
